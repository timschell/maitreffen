<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maitreffen 2026 ‚Äì Zimmerbuchung</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #e8f0e8;
            --bg-paper: #fffef9;
            --text-dark: #2c2c2c;
            --text-muted: #666;
            --bed-free: #7cb564;
            --bed-booked: #d96459;
            --bed-blocked: #9e9e9e;
            --bed-women: #e91e63;
            --bed-men: #2196f3;
            --accent: #5a9a48;
            --accent-light: #e8f4e8;
            --waitlist: #ff9800;
            --waitlist-light: #fff3e0;
            --carpool: #9c27b0;
            --carpool-light: #f3e5f5;
            --train: #00796b;
            --train-light: #e0f2f1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { 
            font-size: 16px;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-primary);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .app {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 50vh;
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .error-banner {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 0.9rem;
        }

        header {
            text-align: center;
            margin-bottom: 1.25rem;
            padding: 1.5rem 1rem;
            background: var(--bg-paper);
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid #d5e5d5;
        }

        h1 {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 0.25rem;
        }

        .event-date {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-top: 0.25rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--accent);
            border: 1px solid #a5d6a7;
        }

        .subtitle { 
            color: var(--text-muted); 
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .location {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-top: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--accent-light);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent);
        }

        .location a {
            color: inherit;
            text-decoration: none;
        }

        .location a:hover {
            text-decoration: underline;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 1.25rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.9rem;
        }

        .stat-dot {
            width: 14px;
            height: 14px;
            border-radius: 4px;
        }

        .stat-dot.free { background: var(--bed-free); }
        .stat-dot.booked { background: var(--bed-booked); }
        .stat-dot.blocked { background: var(--bed-blocked); }
        .stat-dot.waitlist { background: var(--waitlist); }

        .stat-value { font-weight: 700; }

        /* Full Banner */
        .full-banner {
            background: var(--waitlist-light);
            border: 2px solid var(--waitlist);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .full-banner-title {
            font-weight: 700;
            color: #e65100;
            margin-bottom: 0.5rem;
        }

        .full-banner-text {
            font-size: 0.9rem;
            color: #bf360c;
        }

        /* Etagen-Tabs */
        .floor-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            background: var(--bg-paper);
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .floor-tab {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .floor-tab.active {
            background: var(--accent);
            color: white;
        }

        .floor-tab:not(.active):hover {
            background: var(--accent-light);
        }

        /* Zimmer Grid */
        .rooms-grid {
            display: grid;
            gap: 1rem;
        }

        .room-card {
            background: var(--bg-paper);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e8e8e8;
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .room-title {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.3rem;
            color: var(--text-dark);
        }

        .room-badges {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .room-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .room-badge.bath { background: #e3f2fd; color: #1976d2; }
        .room-badge.accessible { background: #fff3e0; color: #f57c00; }
        .room-badge.shared { background: #f5f5f5; color: #666; }

        .beds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 0.75rem;
        }

        .bed-card {
            background: var(--bed-free);
            border: 2px solid #5a9a48;
            border-radius: 10px;
            padding: 0.875rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
            min-height: 75px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .bed-card.booked { background: var(--bed-booked); border-color: #b84a40; }
        .bed-card.blocked { background: var(--bed-blocked); border-color: #757575; }
        .bed-card.women-only { background: var(--bed-women); border-color: #c2185b; }
        .bed-card.men-only { background: var(--bed-men); border-color: #1976d2; }

        .bed-card:active { transform: scale(0.97); }

        .bed-icon { font-size: 1.1rem; margin-bottom: 0.25rem; }
        .bed-label { font-size: 0.7rem; color: rgba(255,255,255,0.85); margin-bottom: 0.15rem; }
        .bed-name { font-weight: 700; color: white; font-size: 0.95rem; word-break: break-word; }
        .bed-info { font-size: 0.65rem; color: rgba(255,255,255,0.8); margin-top: 0.2rem; }

        .bed-badges {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            margin-top: 0.25rem;
            flex-wrap: wrap;
        }

        .bed-mini-badge {
            display: inline-block;
            background: rgba(255,255,255,0.25);
            padding: 0.1rem 0.3rem;
            border-radius: 4px;
            font-size: 0.6rem;
        }

        /* Room Summary */
        .room-summary {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #eee;
            font-size: 0.8rem;
            color: var(--text-muted);
            flex-wrap: wrap;
        }

        .room-stat { display: flex; align-items: center; gap: 0.3rem; }
        .room-stat-dot { width: 8px; height: 8px; border-radius: 50%; }
        .room-stat-dot.free { background: var(--bed-free); }
        .room-stat-dot.booked { background: var(--bed-booked); }
        .room-stat-dot.blocked { background: var(--bed-blocked); }
        .room-stat-dot.women { background: var(--bed-women); }
        .room-stat-dot.men { background: var(--bed-men); }

        /* Transport Sections */
        .transport-section {
            background: var(--bg-paper);
            border-radius: 16px;
            padding: 1.25rem;
            margin-top: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e8e8e8;
        }

        .transport-title {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .transport-title.pickup { color: var(--accent); }
        .transport-title.carpool { color: var(--carpool); }
        .transport-title.train { color: var(--train); }

        .transport-list { display: flex; flex-direction: column; gap: 0.5rem; }

        .transport-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f5f5f5;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .transport-item.carpool { background: var(--carpool-light); }
        .transport-item.train { background: var(--train-light); }

        .transport-item-icon { font-size: 1.2rem; }
        .transport-item-info { flex: 1; }
        .transport-item-name { font-weight: 600; }
        .transport-item-details { color: var(--text-muted); font-size: 0.8rem; }

        .transport-item-seats {
            background: var(--carpool);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .transport-empty {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-align: center;
            padding: 1rem;
        }

        /* Train Groups */
        .train-group {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--train-light);
            border-radius: 10px;
            border-left: 4px solid var(--train);
        }

        .train-group:last-child { margin-bottom: 0; }

        .train-group-header {
            font-weight: 600;
            color: var(--train);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .train-group-badge {
            background: var(--train);
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
        }

        .train-group-members {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .train-member {
            background: white;
            padding: 0.4rem 0.75rem;
            border-radius: 16px;
            font-size: 0.85rem;
            border: 1px solid #b2dfdb;
        }

        /* Waitlist Section */
        .waitlist-section {
            background: var(--bg-paper);
            border-radius: 16px;
            padding: 1.25rem;
            margin-top: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e8e8e8;
        }

        .waitlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .waitlist-title {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.2rem;
            color: var(--waitlist);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .waitlist-count {
            background: var(--waitlist);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .waitlist-empty { text-align: center; padding: 2rem 1rem; color: var(--text-muted); }
        .waitlist-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .waitlist-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem;
            background: #f9f9f9;
            border-radius: 10px;
            border: 1px solid #eee;
        }

        .waitlist-position {
            width: 32px;
            height: 32px;
            background: var(--waitlist);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .waitlist-info { flex: 1; min-width: 0; }
        .waitlist-name { font-weight: 600; color: var(--text-dark); word-break: break-word; }
        .waitlist-meta { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.15rem; }
        .waitlist-comment { font-size: 0.8rem; color: var(--text-muted); font-style: italic; margin-top: 0.25rem; }

        .waitlist-remove {
            background: none;
            border: none;
            color: var(--bed-booked);
            cursor: pointer;
            padding: 0.5rem;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .waitlist-remove:hover { opacity: 1; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: var(--bg-paper);
            border-radius: 24px 24px 0 0;
            padding: 1.5rem;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }

        .modal-handle {
            width: 40px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin: 0 auto 1.25rem;
        }

        .modal h2 {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
            color: var(--accent);
        }

        .modal h2.waitlist-modal-title { color: var(--waitlist); }
        .modal h2.women-modal-title { color: var(--bed-women); }
        .modal h2.men-modal-title { color: var(--bed-men); }

        .modal-room { color: var(--text-muted); margin-bottom: 1rem; font-size: 0.9rem; }

        .modal-input {
            width: 100%;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #ddd;
            background: #fff;
            color: var(--text-dark);
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            margin-bottom: 0.75rem;
            transition: border-color 0.2s;
            -webkit-appearance: none;
        }

        .modal-input:focus { outline: none; border-color: var(--accent); }
        .modal-input.waitlist-input:focus { border-color: var(--waitlist); }

        .modal-textarea {
            width: 100%;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #ddd;
            background: #fff;
            color: var(--text-dark);
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            margin-bottom: 0.75rem;
            resize: vertical;
            min-height: 80px;
        }

        .modal-textarea:focus { outline: none; border-color: var(--waitlist); }

        /* Form Sections */
        .form-section { margin-bottom: 1rem; }
        .form-section-title { font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.9rem; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .form-row.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-group { display: flex; flex-direction: column; gap: 0.25rem; }
        .form-group label { font-size: 0.8rem; color: var(--text-muted); }

        .form-group input, .form-group select {
            padding: 0.75rem;
            border-radius: 10px;
            border: 2px solid #ddd;
            background: #fff;
            color: var(--text-dark);
            font-size: 0.95rem;
            font-family: 'Nunito', sans-serif;
            -webkit-appearance: none;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-group select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            padding-right: 2rem;
        }

        /* Checkbox rows */
        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: #f5f5f5;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 0.75rem;
        }

        .checkbox-row:hover { background: #efefef; }
        .checkbox-row.carpool { background: var(--carpool-light); }
        .checkbox-row.carpool:hover { background: #ede7f6; }

        .checkbox-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .checkbox-row.carpool input[type="checkbox"] { accent-color: var(--carpool); }

        .checkbox-row-label { flex: 1; }
        .checkbox-row-main { font-weight: 600; color: var(--text-dark); font-size: 0.9rem; }
        .checkbox-row-sub { font-size: 0.75rem; color: var(--text-muted); }

        /* Carpool/Train details */
        .extra-details {
            padding: 0.75rem;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .extra-details.carpool { background: var(--carpool-light); }
        .extra-details.train { background: var(--train-light); }

        .extra-details .form-group label { color: var(--carpool); }
        .extra-details.train .form-group label { color: var(--train); }

        .extra-details input { border-color: #ce93d8; }
        .extra-details.train input { border-color: #80cbc4; }

        .extra-details input:focus { border-color: var(--carpool); }
        .extra-details.train input:focus { border-color: var(--train); }

        /* Restriction options */
        .restriction-options { margin-bottom: 1rem; }
        .restriction-label { font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.9rem; }

        .restriction-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .restriction-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: #f5f5f5;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .restriction-option:hover { background: #efefef; }
        .restriction-option.selected { border-color: var(--accent); background: var(--accent-light); }
        .restriction-option.selected.women { border-color: var(--bed-women); background: #fce4ec; }
        .restriction-option.selected.men { border-color: var(--bed-men); background: #e3f2fd; }
        .restriction-option.selected.blocked { border-color: var(--bed-blocked); background: #f5f5f5; }

        .restriction-option input[type="radio"] { display: none; }
        .restriction-option-icon { font-size: 1.1rem; }
        .restriction-option-text { font-size: 0.85rem; color: var(--text-dark); }

        /* Companions */
        .companions-section {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .companions-title {
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .companion-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }

        .companion-row input, .companion-row select {
            flex: 1;
            padding: 0.6rem;
            border-radius: 8px;
            border: 2px solid #90caf9;
            font-family: 'Nunito', sans-serif;
            font-size: 0.9rem;
        }

        .companion-row input:focus, .companion-row select:focus {
            outline: none;
            border-color: #1976d2;
        }

        .companion-row select {
            min-width: 140px;
        }

        .companion-remove {
            background: none;
            border: none;
            color: var(--bed-booked);
            cursor: pointer;
            padding: 0.5rem;
            font-size: 1.1rem;
            opacity: 0.7;
        }

        .companion-remove:hover { opacity: 1; }

        .add-companion-btn {
            background: none;
            border: 2px dashed #90caf9;
            color: #1976d2;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            width: 100%;
            margin-top: 0.25rem;
        }

        .add-companion-btn:hover {
            background: #e3f2fd;
            border-color: #1976d2;
        }

        .modal-buttons { display: flex; gap: 0.75rem; margin-top: 1rem; }

        .btn {
            flex: 1;
            padding: 1rem;
            border-radius: 12px;
            border: none;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn:active:not(:disabled) { transform: scale(0.98); }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: #e0e0e0; color: var(--text-dark); }
        .btn-danger { background: var(--bed-booked); color: white; }
        .btn-waitlist { background: var(--waitlist); color: white; }
        .btn-women { background: var(--bed-women); color: white; }
        .btn-men { background: var(--bed-men); color: white; }

        .current-guest {
            background: #f5f5f5;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .current-guest-label { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.2rem; }
        .current-guest-name { font-weight: 600; color: var(--text-dark); }
        .current-guest-details { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.2rem; }

        .blocked-info {
            background: #fff3e0;
            border: 1px solid #ffcc80;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .blocked-info-title { font-weight: 600; color: #e65100; margin-bottom: 0.25rem; }
        .blocked-info-text { font-size: 0.85rem; color: #bf360c; }

        .gender-info { padding: 1rem; border-radius: 12px; margin-bottom: 1rem; }
        .gender-info.women { background: #fce4ec; border: 1px solid #f48fb1; }
        .gender-info.men { background: #e3f2fd; border: 1px solid #90caf9; }
        .gender-info-title { font-weight: 600; margin-bottom: 0.25rem; }
        .gender-info.women .gender-info-title { color: #c2185b; }
        .gender-info.men .gender-info-title { color: #1976d2; }
        .gender-info-text { font-size: 0.85rem; }
        .gender-info.women .gender-info-text { color: #880e4f; }
        .gender-info.men .gender-info-text { color: #0d47a1; }

        /* Info Section */
        .info-section {
            background: var(--bg-paper);
            border-radius: 16px;
            padding: 1.25rem;
            margin-top: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e8e8e8;
        }

        .info-title {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            color: var(--accent);
        }

        .info-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .info-text a { color: var(--accent); }

        /* Desktop */
        @media (min-width: 768px) {
            .app { padding: 1.5rem; }
            h1 { font-size: 2.4rem; }
            .rooms-grid { grid-template-columns: repeat(2, 1fr); }
            .modal-overlay { align-items: center; padding: 1rem; }
            .modal { border-radius: 20px; }
            .modal-handle { display: none; }
        }

        @media (min-width: 1024px) {
            .rooms-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const API_URL = '/api';

        const EVENT = {
            name: 'Maitreffen 2026',
            startDate: '2026-05-13',
            endDate: '2026-05-17',
            displayDate: '13. ‚Äì 17. Mai 2026'
        };

        const ROOMS = [
            { id: 1, name: 'Zimmer 1', beds: 3, floor: 'eg', bath: true, accessible: false },
            { id: 2, name: 'Zimmer 2', beds: 2, floor: 'eg', bath: true, accessible: true },
            { id: 3, name: 'Zimmer 3', beds: 2, floor: 'eg', bath: true, accessible: false },
            { id: 4, name: 'Zimmer 4', beds: 3, floor: 'og', bath: false, accessible: false },
            { id: 5, name: 'Zimmer 5', beds: 4, floor: 'og', bath: false, accessible: false },
            { id: 6, name: 'Zimmer 6', beds: 3, floor: 'og', bath: false, accessible: false },
            { id: 7, name: 'Zimmer 7', beds: 3, floor: 'og', bath: false, accessible: false },
            { id: 8, name: 'Zimmer 8', beds: 2, floor: 'og', bath: false, accessible: false },
            { id: 9, name: 'Zimmer 9', beds: 3, floor: 'og', bath: false, accessible: false },
        ];

        const generateBeds = () => {
            const beds = {};
            ROOMS.forEach(room => {
                for (let i = 1; i <= room.beds; i++) {
                    beds[`zi${room.id}-bett${i}`] = { room: room.name, roomId: room.id, bedNum: i };
                }
            });
            return beds;
        };

        const BEDS = generateBeds();
        const TOTAL_SLOTS = Object.keys(BEDS).length;

        const getRoomBedIds = (roomId) => {
            const room = ROOMS.find(r => r.id === roomId);
            return room ? Array.from({ length: room.beds }, (_, i) => `zi${roomId}-bett${i + 1}`) : [];
        };

        const formatDate = (d) => d ? new Date(d).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' }) : '';
        const formatDateTime = (d) => new Date(d).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });
        const formatDateLong = (d) => d ? new Date(d).toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' }) : '';
        const formatTime = (t) => t ? t.slice(0,5) : '';

        const transportLabels = { 'auto': 'üöó Auto', 'oepnv': 'üöÜ √ñffis', '': '' };

        function App() {
            const [bookings, setBookings] = useState({});
            const [waitlist, setWaitlist] = useState([]);
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [error, setError] = useState(null);
            const [modalOpen, setModalOpen] = useState(false);
            const [waitlistModalOpen, setWaitlistModalOpen] = useState(false);
            const [selectedBed, setSelectedBed] = useState(null);
            const [inputName, setInputName] = useState("");
            const [arrivalDate, setArrivalDate] = useState(EVENT.startDate);
            const [departureDate, setDepartureDate] = useState(EVENT.endDate);
            const [transport, setTransport] = useState('');
            const [needsPickup, setNeedsPickup] = useState(false);
            const [canOfferRide, setCanOfferRide] = useState(false);
            const [seatsAvailable, setSeatsAvailable] = useState(1);
            const [departureCity, setDepartureCity] = useState('');
            const [trainStation, setTrainStation] = useState('');
            const [trainTime, setTrainTime] = useState('');
            const [trainNumber, setTrainNumber] = useState('');
            const [arrivalTime, setArrivalTime] = useState('');
            const [departureTime, setDepartureTime] = useState('');
            const [waitlistName, setWaitlistName] = useState("");
            const [waitlistComment, setWaitlistComment] = useState("");
            const [roomRestriction, setRoomRestriction] = useState('none');
            const [companions, setCompanions] = useState([]); // [{name: '', bedId: ''}]
            const [activeFloor, setActiveFloor] = useState('eg');

            useEffect(() => { loadBookings(); loadWaitlist(); }, []);

            useEffect(() => {
                if (transport !== 'oepnv') {
                    setNeedsPickup(false);
                    setTrainStation('');
                    setTrainTime('');
                    setTrainNumber('');
                }
                if (transport !== 'auto') {
                    setCanOfferRide(false);
                    setSeatsAvailable(1);
                    setDepartureCity('');
                }
            }, [transport]);

            const loadBookings = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    const res = await fetch(`${API_URL}/bookings`);
                    if (!res.ok) throw new Error();
                    setBookings(await res.json());
                } catch { setError('Buchungen konnten nicht geladen werden.'); }
                finally { setLoading(false); }
            };

            const loadWaitlist = async () => {
                try {
                    const res = await fetch(`${API_URL}/waitlist`);
                    if (res.ok) setWaitlist(await res.json());
                } catch {}
            };

            const handleBedClick = (bedId) => {
                setSelectedBed(bedId);
                const b = bookings[bedId];
                setInputName(b?.name?.replace(/^[üîí‚ôÄÔ∏è‚ôÇÔ∏è]\s*/, '').replace(/^(Frauenzimmer|M√§nnerzimmer)$/, '') || "");
                setArrivalDate(b?.arrivalDate && b.arrivalDate !== '' ? b.arrivalDate : EVENT.startDate);
                setDepartureDate(b?.departureDate && b.departureDate !== '' ? b.departureDate : EVENT.endDate);
                setTransport(b?.transport || '');
                setNeedsPickup(b?.needsPickup || false);
                setCanOfferRide(b?.canOfferRide || false);
                setSeatsAvailable(b?.seatsAvailable || 1);
                setDepartureCity(b?.departureCity || '');
                setTrainStation(b?.trainStation || '');
                setTrainTime(b?.trainTime ? formatTime(b.trainTime) : '');
                setTrainNumber(b?.trainNumber || '');
                setArrivalTime(b?.arrivalTime ? formatTime(b.arrivalTime) : '');
                setDepartureTime(b?.departureTime ? formatTime(b.departureTime) : '');
                setRoomRestriction('none');
                setCompanions([]);
                setModalOpen(true);
            };

            const getBookingPayload = () => ({
                name: inputName.trim(),
                arrivalDate: arrivalDate || null,
                departureDate: departureDate || null,
                transport: transport || null,
                needsPickup: transport === 'oepnv' ? needsPickup : false,
                canOfferRide: transport === 'auto' ? canOfferRide : false,
                seatsAvailable: transport === 'auto' && canOfferRide ? seatsAvailable : 0,
                departureCity: transport === 'auto' && canOfferRide ? departureCity : null,
                trainStation: transport === 'oepnv' ? trainStation : null,
                trainTime: transport === 'oepnv' && trainTime ? trainTime : null,
                trainNumber: transport === 'oepnv' ? trainNumber : null,
                arrivalTime: arrivalTime || null,
                departureTime: departureTime || null
            });

            const handleBook = async () => {
                if (!inputName.trim() || saving) return;
                // Validiere Mitreisende
                const validCompanions = companions.filter(c => c.name.trim() && c.bedId);
                setSaving(true);
                setError(null);
                try {
                    // Hauptbuchung
                    const res = await fetch(`${API_URL}/bookings/${selectedBed}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...getBookingPayload(), roomRestriction, roomBeds: getRoomBedIds(BEDS[selectedBed].roomId) })
                    });
                    if (!res.ok) throw new Error();
                    
                    // Mitreisende buchen (gleiche Reisedaten)
                    for (const companion of validCompanions) {
                        await fetch(`${API_URL}/bookings/${companion.bedId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ 
                                ...getBookingPayload(), 
                                name: companion.name.trim(),
                                roomRestriction: 'none',
                                roomBeds: []
                            })
                        });
                    }
                    
                    await loadBookings();
                    closeModal();
                } catch { setError('Buchung konnte nicht gespeichert werden.'); }
                finally { setSaving(false); }
            };

            const handleClaimGenderBed = async () => {
                if (!inputName.trim() || saving) return;
                setSaving(true);
                setError(null);
                try {
                    const res = await fetch(`${API_URL}/bookings/${selectedBed}/claim`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(getBookingPayload())
                    });
                    if (!res.ok) throw new Error();
                    await loadBookings();
                    closeModal();
                } catch { setError('Buchung konnte nicht gespeichert werden.'); }
                finally { setSaving(false); }
            };

            const handleCancel = async () => {
                if (saving) return;
                setSaving(true);
                try {
                    await fetch(`${API_URL}/bookings/${selectedBed}`, { method: 'DELETE' });
                    await loadBookings();
                    closeModal();
                } catch { setError('Stornierung fehlgeschlagen.'); }
                finally { setSaving(false); }
            };

            const handleUnblock = async () => {
                if (saving) return;
                setSaving(true);
                try {
                    await fetch(`${API_URL}/bookings/${selectedBed}/unblock`, { method: 'DELETE' });
                    await loadBookings();
                    closeModal();
                } catch { setError('Freigabe fehlgeschlagen.'); }
                finally { setSaving(false); }
            };

            const handleAddToWaitlist = async () => {
                if (!waitlistName.trim() || saving) return;
                setSaving(true);
                try {
                    await fetch(`${API_URL}/waitlist`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: waitlistName.trim(), comment: waitlistComment.trim() || null })
                    });
                    await loadWaitlist();
                    closeWaitlistModal();
                } catch { setError('Konnte nicht zur Warteliste hinzugef√ºgt werden.'); }
                finally { setSaving(false); }
            };

            const handleRemoveFromWaitlist = async (id) => {
                if (saving || !confirm('Wirklich von der Warteliste entfernen?')) return;
                setSaving(true);
                try {
                    await fetch(`${API_URL}/waitlist/${id}`, { method: 'DELETE' });
                    await loadWaitlist();
                } catch { setError('Entfernen fehlgeschlagen.'); }
                finally { setSaving(false); }
            };

            const closeModal = () => {
                setModalOpen(false);
                setSelectedBed(null);
                setInputName("");
                setArrivalDate(EVENT.startDate);
                setDepartureDate(EVENT.endDate);
                setTransport('');
                setNeedsPickup(false);
                setCanOfferRide(false);
                setSeatsAvailable(1);
                setDepartureCity('');
                setTrainStation('');
                setTrainTime('');
                setTrainNumber('');
                setArrivalTime('');
                setDepartureTime('');
                setRoomRestriction('none');
                setCompanions([]);
            };

            const closeWaitlistModal = () => { setWaitlistModalOpen(false); setWaitlistName(""); setWaitlistComment(""); };

            const countStats = () => {
                let booked = 0, blocked = 0, women = 0, men = 0;
                Object.values(bookings).forEach(b => {
                    if (b.status === 'blocked') blocked++;
                    else if (b.status === 'women_only') women++;
                    else if (b.status === 'men_only') men++;
                    else booked++;
                });
                return { booked, blocked, women, men, free: TOTAL_SLOTS - booked - blocked - women - men };
            };

            const stats = countStats();
            const isFull = stats.free === 0 && stats.women === 0 && stats.men === 0;

            const getRoomStats = (roomId) => {
                const room = ROOMS.find(r => r.id === roomId);
                let booked = 0, blocked = 0, women = 0, men = 0;
                for (let i = 1; i <= room.beds; i++) {
                    const b = bookings[`zi${roomId}-bett${i}`];
                    if (b) {
                        if (b.status === 'blocked') blocked++;
                        else if (b.status === 'women_only') women++;
                        else if (b.status === 'men_only') men++;
                        else booked++;
                    }
                }
                return { booked, blocked, women, men, free: room.beds - booked - blocked - women - men };
            };

            const filteredRooms = ROOMS.filter(r => r.floor === activeFloor);
            const getFloorFreeCount = (floor) => ROOMS.filter(r => r.floor === floor).reduce((sum, r) => sum + getRoomStats(r.id).free, 0);
            const hasFreeBeds = () => selectedBed && getRoomBedIds(BEDS[selectedBed].roomId).some(id => id !== selectedBed && !bookings[id]);
            
            // Alle freien Betten (f√ºr Mitreisende-Auswahl)
            const getAvailableBeds = () => {
                if (!selectedBed) return [];
                const selectedCompanionBeds = companions.map(c => c.bedId);
                return Object.entries(BEDS)
                    .filter(([id, _]) => id !== selectedBed && !bookings[id] && !selectedCompanionBeds.includes(id))
                    .map(([id, info]) => ({ id, ...info }))
                    .sort((a, b) => a.roomId - b.roomId || a.bedNum - b.bedNum);
            };
            
            const addCompanion = () => setCompanions([...companions, { name: '', bedId: '' }]);
            const removeCompanion = (idx) => setCompanions(companions.filter((_, i) => i !== idx));
            const updateCompanion = (idx, field, value) => {
                const updated = [...companions];
                updated[idx][field] = value;
                setCompanions(updated);
            };
            const getBlockerName = (b) => b?.blockedBy ? bookings[b.blockedBy]?.name : null;

            const pickupList = Object.entries(bookings).filter(([_, b]) => b.needsPickup && b.status === 'booked').map(([id, b]) => ({ bedId: id, ...b })).sort((a, b) => new Date(a.arrivalDate) - new Date(b.arrivalDate));
            const carpoolList = Object.entries(bookings).filter(([_, b]) => b.canOfferRide && b.status === 'booked' && b.seatsAvailable > 0).map(([id, b]) => ({ bedId: id, ...b })).sort((a, b) => new Date(a.arrivalDate) - new Date(b.arrivalDate));

            // Hilfsfunktion f√ºr Zeit-Matching
            const timeToMinutes = (t) => {
                if (!t) return null;
                const [h, m] = t.split(':').map(Number);
                return h * 60 + m;
            };
            
            // Zugverbindungen gruppieren - nach Ankunftszeit in Halbe (¬±30 min)
            const trainTravelers = Object.entries(bookings)
                .filter(([_, b]) => b.status === 'booked' && b.transport === 'oepnv' && b.trainTime)
                .map(([id, b]) => ({ bedId: id, ...b }))
                .sort((a, b) => timeToMinutes(a.trainTime) - timeToMinutes(b.trainTime));
            
            const trainGroups = [];
            const grouped = new Set();
            
            trainTravelers.forEach(t => {
                if (grouped.has(t.bedId)) return;
                
                const tMinutes = timeToMinutes(t.trainTime);
                const group = { 
                    time: t.trainTime,
                    label: `üöÜ Ankunft ${formatTime(t.trainTime)} in Halbe`, 
                    members: [t] 
                };
                
                // Finde alle die ¬±30 min ankommen
                trainTravelers.forEach(other => {
                    if (other.bedId !== t.bedId && !grouped.has(other.bedId)) {
                        const oMinutes = timeToMinutes(other.trainTime);
                        if (Math.abs(tMinutes - oMinutes) <= 30) {
                            group.members.push(other);
                            grouped.add(other.bedId);
                        }
                    }
                });
                
                grouped.add(t.bedId);
                if (group.members.length > 1) trainGroups.push(group);
            });

            if (loading) return <div className="app"><div className="loading">üå≥ Lade Buchungen...</div></div>;

            const selectedBooking = selectedBed ? bookings[selectedBed] : null;
            const bedStatus = selectedBooking?.status || 'free';
            const isBlocked = bedStatus === 'blocked';
            const isWomenOnly = bedStatus === 'women_only';
            const isMenOnly = bedStatus === 'men_only';
            const isBooked = selectedBooking && !isBlocked && !isWomenOnly && !isMenOnly;
            const isGenderRestricted = isWomenOnly || isMenOnly;

            const travelFormJSX = (
                <>
                    <div className="form-section">
                        <div className="form-section-title">üóìÔ∏è Anreise & Abreise</div>
                        <div style={{background: '#e8f5e9', padding: '0.5rem 0.75rem', borderRadius: '8px', marginBottom: '0.75rem', fontSize: '0.8rem', color: 'var(--accent)'}}>
                            ‚ÑπÔ∏è Check-in ab <strong>16:00 Uhr</strong> ¬∑ Check-out bis ca. <strong>11:00 Uhr</strong>
                        </div>
                        <div className="form-row">
                            <div className="form-group">
                                <label>Anreise (Datum)</label>
                                <input type="date" value={arrivalDate} onChange={e => setArrivalDate(e.target.value)} disabled={saving} />
                            </div>
                            <div className="form-group">
                                <label>Uhrzeit</label>
                                <input type="time" value={arrivalTime} onChange={e => setArrivalTime(e.target.value)} disabled={saving} placeholder="ab 16:00" />
                            </div>
                        </div>
                        <div className="form-row">
                            <div className="form-group">
                                <label>Abreise (Datum)</label>
                                <input type="date" value={departureDate} onChange={e => setDepartureDate(e.target.value)} disabled={saving} />
                            </div>
                            <div className="form-group">
                                <label>Uhrzeit</label>
                                <input type="time" value={departureTime} onChange={e => setDepartureTime(e.target.value)} disabled={saving} placeholder="bis 11:00" />
                            </div>
                        </div>
                        <div className="form-group">
                            <label>Anreise mit</label>
                            <select value={transport} onChange={e => setTransport(e.target.value)} disabled={saving}>
                                <option value="">‚Äì Bitte w√§hlen ‚Äì</option>
                                <option value="auto">üöó Auto</option>
                                <option value="oepnv">üöÜ √ñffentliche Verkehrsmittel</option>
                            </select>
                        </div>
                    </div>

                    {transport === 'oepnv' && (
                        <>
                            <div className="form-section">
                                <div className="form-section-title">üöÜ Zugverbindung (f√ºr Reisepartner-Matching)</div>
                                <p style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginBottom: '0.75rem'}}>
                                    Wir matchen Leute die zur gleichen Zeit in Halbe ankommen ‚Äì die sitzen wahrscheinlich im selben Zug!
                                </p>
                                <div className="extra-details train">
                                    <div className="form-group">
                                        <label>Ich starte in...</label>
                                        <input type="text" placeholder="z.B. Berlin, Potsdam, Dresden" value={trainStation} onChange={e => setTrainStation(e.target.value)} disabled={saving} />
                                    </div>
                                    <div className="form-group">
                                        <label>Ankunft in Halbe</label>
                                        <input type="time" value={trainTime} onChange={e => setTrainTime(e.target.value)} disabled={saving} />
                                    </div>
                                </div>
                            </div>

                            <label className="checkbox-row" onClick={() => setNeedsPickup(!needsPickup)}>
                                <input type="checkbox" checked={needsPickup} onChange={e => setNeedsPickup(e.target.checked)} onClick={e => e.stopPropagation()} />
                                <div className="checkbox-row-label">
                                    <div className="checkbox-row-main">üöâ Abholung vom Bahnhof gew√ºnscht</div>
                                    <div className="checkbox-row-sub">Jemand holt dich vom Bahnhof Halbe ab</div>
                                </div>
                            </label>
                        </>
                    )}

                    {transport === 'auto' && (
                        <>
                            <label className="checkbox-row carpool" onClick={() => setCanOfferRide(!canOfferRide)}>
                                <input type="checkbox" checked={canOfferRide} onChange={e => setCanOfferRide(e.target.checked)} onClick={e => e.stopPropagation()} />
                                <div className="checkbox-row-label">
                                    <div className="checkbox-row-main">üöó Ich kann jemanden mitnehmen</div>
                                    <div className="checkbox-row-sub">Biete eine Mitfahrgelegenheit an</div>
                                </div>
                            </label>

                            {canOfferRide && (
                                <div className="extra-details carpool">
                                    <div className="form-group">
                                        <label>Freie Pl√§tze</label>
                                        <input type="number" min="1" max="6" value={seatsAvailable} onChange={e => setSeatsAvailable(parseInt(e.target.value) || 1)} disabled={saving} />
                                    </div>
                                    <div className="form-group">
                                        <label>Abfahrt von</label>
                                        <input type="text" placeholder="z.B. Berlin" value={departureCity} onChange={e => setDepartureCity(e.target.value)} disabled={saving} />
                                    </div>
                                </div>
                            )}
                        </>
                    )}
                </>
            );

            return (
                <div className="app">
                    {error && <div className="error-banner">‚ö†Ô∏è {error}</div>}

                    <header>
                        <h1>üå≤ Maitreffen</h1>
                        <div className="event-date">üìÖ {EVENT.displayDate}</div>
                        <p className="subtitle">Zimmerbelegung ‚Äì tippe auf ein Bett</p>
                        <div className="location">üìç <a href="https://www.freizeitheim-halbe.de" target="_blank" rel="noopener">Freizeitheim Halbe</a></div>
                        <div className="stats">
                            <div className="stat"><div className="stat-dot free"></div><span><span className="stat-value">{stats.free}</span> frei</span></div>
                            <div className="stat"><div className="stat-dot booked"></div><span><span className="stat-value">{stats.booked}</span> belegt</span></div>
                            {(stats.blocked + stats.women + stats.men > 0) && <div className="stat"><div className="stat-dot blocked"></div><span><span className="stat-value">{stats.blocked + stats.women + stats.men}</span> reserviert</span></div>}
                            {waitlist.length > 0 && <div className="stat"><div className="stat-dot waitlist"></div><span><span className="stat-value">{waitlist.length}</span> Warteliste</span></div>}
                        </div>
                    </header>

                    {isFull && (
                        <div className="full-banner">
                            <div className="full-banner-title">üéâ Alle Betten sind belegt!</div>
                            <div className="full-banner-text">Du kannst dich unten auf die Warteliste setzen lassen.</div>
                        </div>
                    )}

                    <div className="floor-tabs">
                        <button className={`floor-tab ${activeFloor === 'eg' ? 'active' : ''}`} onClick={() => setActiveFloor('eg')}>Erdgeschoss ({getFloorFreeCount('eg')} frei)</button>
                        <button className={`floor-tab ${activeFloor === 'og' ? 'active' : ''}`} onClick={() => setActiveFloor('og')}>Obergeschoss ({getFloorFreeCount('og')} frei)</button>
                    </div>

                    <div className="rooms-grid">
                        {filteredRooms.map(room => {
                            const rs = getRoomStats(room.id);
                            return (
                                <div key={room.id} className="room-card">
                                    <div className="room-header">
                                        <h3 className="room-title">{room.name}</h3>
                                        <div className="room-badges">
                                            {room.bath && <span className="room-badge bath">üöø Eigenes Bad</span>}
                                            {room.accessible && <span className="room-badge accessible">‚ôø Barrierefrei</span>}
                                            {!room.bath && <span className="room-badge shared">Gemeinschaftsbad</span>}
                                        </div>
                                    </div>
                                    <div className="beds-grid">
                                        {Array.from({ length: room.beds }, (_, i) => {
                                            const bedId = `zi${room.id}-bett${i + 1}`;
                                            const b = bookings[bedId];
                                            const status = b?.status || 'free';
                                            const booked = b && status === 'booked';
                                            const blocked = status === 'blocked';
                                            const women = status === 'women_only';
                                            const men = status === 'men_only';
                                            
                                            return (
                                                <div key={bedId} className={`bed-card ${booked ? 'booked' : ''} ${blocked ? 'blocked' : ''} ${women ? 'women-only' : ''} ${men ? 'men-only' : ''}`} onClick={() => handleBedClick(bedId)}>
                                                    <div className="bed-icon">{blocked ? 'üîí' : women ? '‚ôÄÔ∏è' : men ? '‚ôÇÔ∏è' : booked ? 'üò¥' : 'üõèÔ∏è'}</div>
                                                    <div className="bed-label">Bett {i + 1}</div>
                                                    <div className="bed-name">{blocked ? 'Blockiert' : women ? 'Nur Frauen' : men ? 'Nur M√§nner' : booked ? b.name : 'Frei'}</div>
                                                    {booked && b.arrivalDate && <div className="bed-info">{formatDate(b.arrivalDate)}{b.arrivalTime ? ` ${formatTime(b.arrivalTime)}` : ''} ‚Äì {formatDate(b.departureDate)}{b.departureTime ? ` ${formatTime(b.departureTime)}` : ''}</div>}
                                                    {booked && (b.needsPickup || b.canOfferRide || b.trainTime) && (
                                                        <div className="bed-badges">
                                                            {b.needsPickup && <span className="bed-mini-badge">üöâ</span>}
                                                            {b.canOfferRide && <span className="bed-mini-badge">üöó+{b.seatsAvailable}</span>}
                                                            {b.trainTime && <span className="bed-mini-badge">üöÜ {formatTime(b.trainTime)}</span>}
                                                        </div>
                                                    )}
                                                    {(blocked || women || men) && b.blockedBy && <div className="bed-info">von {bookings[b.blockedBy]?.name || '?'}</div>}
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <div className="room-summary">
                                        <div className="room-stat"><div className="room-stat-dot free"></div><span>{rs.free} frei</span></div>
                                        <div className="room-stat"><div className="room-stat-dot booked"></div><span>{rs.booked} belegt</span></div>
                                        {rs.blocked > 0 && <div className="room-stat"><div className="room-stat-dot blocked"></div><span>{rs.blocked} üîí</span></div>}
                                        {rs.women > 0 && <div className="room-stat"><div className="room-stat-dot women"></div><span>{rs.women} ‚ôÄÔ∏è</span></div>}
                                        {rs.men > 0 && <div className="room-stat"><div className="room-stat-dot men"></div><span>{rs.men} ‚ôÇÔ∏è</span></div>}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Gemeinsame Zugfahrten */}
                    {trainGroups.length > 0 && (
                        <div className="transport-section">
                            <h4 className="transport-title train">üöÜ Gemeinsam im Zug?</h4>
                            <p style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginBottom: '0.75rem', marginTop: '-0.5rem'}}>
                                Diese Leute kommen etwa zur gleichen Zeit in Halbe an ‚Äì wahrscheinlich im selben Zug!
                            </p>
                            {trainGroups.map((g, i) => (
                                <div key={i} className="train-group">
                                    <div className="train-group-header">
                                        {g.label}
                                        <span className="train-group-badge">{g.members.length} Personen</span>
                                    </div>
                                    <div className="train-group-members">
                                        {g.members.map(m => (
                                            <span key={m.bedId} className="train-member">
                                                {m.name}{m.trainStation ? ` (ab ${m.trainStation})` : ''}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Fahrgemeinschaften */}
                    {carpoolList.length > 0 && (
                        <div className="transport-section">
                            <h4 className="transport-title carpool">üöó Fahrgemeinschaften</h4>
                            <div className="transport-list">
                                {carpoolList.map(p => (
                                    <div key={p.bedId} className="transport-item carpool">
                                        <span className="transport-item-icon">üöó</span>
                                        <div className="transport-item-info">
                                            <div className="transport-item-name">{p.name}</div>
                                            <div className="transport-item-details">{p.departureCity && `Ab ${p.departureCity} ‚Ä¢ `}{formatDateLong(p.arrivalDate)}{p.arrivalTime ? ` ${formatTime(p.arrivalTime)}` : ''}</div>
                                        </div>
                                        <span className="transport-item-seats">{p.seatsAvailable} {p.seatsAvailable === 1 ? 'Platz' : 'Pl√§tze'}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Abholungen */}
                    {pickupList.length > 0 && (
                        <div className="transport-section">
                            <h4 className="transport-title pickup">üöâ Abholungen vom Bahnhof</h4>
                            <div className="transport-list">
                                {pickupList.map(p => (
                                    <div key={p.bedId} className="transport-item">
                                        <span className="transport-item-icon">üöâ</span>
                                        <div className="transport-item-info">
                                            <div className="transport-item-name">{p.name}</div>
                                            <div className="transport-item-details">{formatDateLong(p.arrivalDate)}{p.arrivalTime ? ` um ${formatTime(p.arrivalTime)}` : ''}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Warteliste */}
                    <div className="waitlist-section">
                        <div className="waitlist-header">
                            <h4 className="waitlist-title">üìã Warteliste {waitlist.length > 0 && <span className="waitlist-count">{waitlist.length}</span>}</h4>
                            <button className="btn btn-waitlist" style={{flex: 'none', padding: '0.5rem 1rem', fontSize: '0.85rem'}} onClick={() => setWaitlistModalOpen(true)}>+ Eintragen</button>
                        </div>
                        {waitlist.length === 0 ? <div className="waitlist-empty">Noch niemand auf der Warteliste</div> : (
                            <div className="waitlist-list">
                                {waitlist.map((e, i) => (
                                    <div key={e.id} className="waitlist-item">
                                        <div className="waitlist-position">{i + 1}</div>
                                        <div className="waitlist-info">
                                            <div className="waitlist-name">{e.name}</div>
                                            <div className="waitlist-meta">Eingetragen am {formatDateTime(e.created_at)}</div>
                                            {e.comment && <div className="waitlist-comment">"{e.comment}"</div>}
                                        </div>
                                        <button className="waitlist-remove" onClick={() => handleRemoveFromWaitlist(e.id)}>‚úï</button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Info */}
                    <div className="info-section">
                        <h4 className="info-title">‚ÑπÔ∏è √úber das Haus</h4>
                        <p className="info-text">
                            Das Evangelische Freizeitheim Halbe bietet 9 Zimmer mit insgesamt 25 Betten.<br/><br/>
                            <strong>Erdgeschoss:</strong> 3 Zimmer mit eigenem Bad (Zi 2 ist barrierefrei)<br/>
                            <strong>Obergeschoss:</strong> 6 Zimmer mit 2 Gemeinschaftsb√§dern<br/><br/>
                            üõèÔ∏è <strong>Bettw√§sche ist mitzubringen</strong> oder kann f√ºr 8,50 ‚Ç¨ ausgeliehen werden.<br/><br/>
                            ‚è∞ <strong>Check-in ab 16:00 Uhr</strong> ¬∑ <strong>Check-out bis ca. 11:00 Uhr</strong><br/><br/>
                            üîí <strong>Zimmer-Optionen:</strong> Beim Buchen kannst du restliche Betten blockieren oder als Frauen-/M√§nnerzimmer markieren.<br/>
                            üöó <strong>Fahrgemeinschaften:</strong> Autofahrer k√∂nnen Mitfahrgelegenheiten anbieten.<br/>
                            üöÜ <strong>Zugverbindungen:</strong> Trage deine Verbindung ein um Reisepartner zu finden!<br/><br/>
                            üìç Kirchstra√üe 7, 15757 Halbe<br/>
                            üåê <a href="https://www.freizeitheim-halbe.de" target="_blank" rel="noopener">www.freizeitheim-halbe.de</a>
                        </p>
                    </div>

                    {/* Modal */}
                    {modalOpen && selectedBed && (
                        <div className="modal-overlay" onClick={closeModal}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div className="modal-handle"></div>
                                
                                {isBlocked ? (
                                    <>
                                        <h2>üîí Blockiert</h2>
                                        <p className="modal-room">{BEDS[selectedBed].room} ‚Äì Bett {BEDS[selectedBed].bedNum}</p>
                                        <div className="blocked-info">
                                            <div className="blocked-info-title">Dieses Bett ist blockiert</div>
                                            <div className="blocked-info-text">Blockiert von: {getBlockerName(selectedBooking) || 'Unbekannt'}</div>
                                        </div>
                                        <div className="modal-buttons">
                                            <button className="btn btn-secondary" onClick={closeModal}>Schlie√üen</button>
                                            <button className="btn btn-danger" onClick={handleUnblock} disabled={saving}>{saving ? '...' : 'Freigeben'}</button>
                                        </div>
                                    </>
                                ) : isGenderRestricted ? (
                                    <>
                                        <h2 className={isWomenOnly ? 'women-modal-title' : 'men-modal-title'}>{isWomenOnly ? '‚ôÄÔ∏è Frauenzimmer' : '‚ôÇÔ∏è M√§nnerzimmer'}</h2>
                                        <p className="modal-room">{BEDS[selectedBed].room} ‚Äì Bett {BEDS[selectedBed].bedNum}</p>
                                        <div className={`gender-info ${isWomenOnly ? 'women' : 'men'}`}>
                                            <div className="gender-info-title">{isWomenOnly ? 'Dieses Zimmer ist f√ºr Frauen reserviert' : 'Dieses Zimmer ist f√ºr M√§nner reserviert'}</div>
                                            <div className="gender-info-text">Reserviert von: {getBlockerName(selectedBooking) || 'Unbekannt'}</div>
                                        </div>
                                        <input type="text" className="modal-input" placeholder="Dein Name" value={inputName} onChange={e => setInputName(e.target.value)} autoFocus disabled={saving} />
                                        {travelFormJSX}
                                        <div className="modal-buttons">
                                            <button className="btn btn-secondary" onClick={closeModal}>Abbrechen</button>
                                            <button className="btn btn-danger" onClick={handleUnblock} disabled={saving}>{saving ? '...' : 'Aufheben'}</button>
                                            <button className={`btn ${isWomenOnly ? 'btn-women' : 'btn-men'}`} onClick={handleClaimGenderBed} disabled={saving || !inputName.trim()}>{saving ? '...' : 'Buchen'}</button>
                                        </div>
                                    </>
                                ) : (
                                    <>
                                        <h2>{isBooked ? 'üìù Bearbeiten' : '‚ú® Reservieren'}</h2>
                                        <p className="modal-room">{BEDS[selectedBed].room} ‚Äì Bett {BEDS[selectedBed].bedNum}</p>
                                        {isBooked && (
                                            <div className="current-guest">
                                                <div className="current-guest-label">Aktuell gebucht:</div>
                                                <div className="current-guest-name">{selectedBooking.name}</div>
                                                <div className="current-guest-details">
                                                    {selectedBooking.arrivalDate && <span>üìÖ {formatDateLong(selectedBooking.arrivalDate)}{selectedBooking.arrivalTime ? ` ${formatTime(selectedBooking.arrivalTime)}` : ''} ‚Äì {formatDateLong(selectedBooking.departureDate)}{selectedBooking.departureTime ? ` ${formatTime(selectedBooking.departureTime)}` : ''}</span>}
                                                    {selectedBooking.transport && <span>{transportLabels[selectedBooking.transport]}</span>}
                                                    {selectedBooking.trainTime && <span>üöÜ Ankunft Halbe: {formatTime(selectedBooking.trainTime)}{selectedBooking.trainStation ? ` (ab ${selectedBooking.trainStation})` : ''}</span>}
                                                    {selectedBooking.needsPickup && <span>üöâ Abholung gew√ºnscht</span>}
                                                    {selectedBooking.canOfferRide && <span>üöó Bietet {selectedBooking.seatsAvailable} Pl√§tze ab {selectedBooking.departureCity || '?'}</span>}
                                                </div>
                                            </div>
                                        )}
                                        <input type="text" className="modal-input" placeholder="Dein Name" value={inputName} onChange={e => setInputName(e.target.value)} autoFocus disabled={saving} />
                                        {travelFormJSX}
                                        {/* Mitreisende */}
                                        {!isBooked && getAvailableBeds().length > 0 && (
                                            <div className="companions-section">
                                                <div className="companions-title">üë®‚Äçüë©‚Äçüëß Mitreisende (gleiche Reisedaten)</div>
                                                {companions.map((c, idx) => (
                                                    <div key={idx} className="companion-row">
                                                        <input 
                                                            type="text" 
                                                            placeholder="Name" 
                                                            value={c.name} 
                                                            onChange={e => updateCompanion(idx, 'name', e.target.value)}
                                                            disabled={saving}
                                                        />
                                                        <select 
                                                            value={c.bedId} 
                                                            onChange={e => updateCompanion(idx, 'bedId', e.target.value)}
                                                            disabled={saving}
                                                        >
                                                            <option value="">Bett w√§hlen...</option>
                                                            {getAvailableBeds().map(bed => (
                                                                <option key={bed.id} value={bed.id}>{bed.room} ‚Äì Bett {bed.bedNum}</option>
                                                            ))}
                                                            {c.bedId && !getAvailableBeds().find(b => b.id === c.bedId) && (
                                                                <option value={c.bedId}>{BEDS[c.bedId]?.room} ‚Äì Bett {BEDS[c.bedId]?.bedNum}</option>
                                                            )}
                                                        </select>
                                                        <button type="button" className="companion-remove" onClick={() => removeCompanion(idx)}>‚úï</button>
                                                    </div>
                                                ))}
                                                <button type="button" className="add-companion-btn" onClick={addCompanion} disabled={saving}>
                                                    + Weitere Person hinzuf√ºgen
                                                </button>
                                            </div>
                                        )}

                                        {!isBooked && hasFreeBeds() && (
                                            <div className="restriction-options">
                                                <div className="restriction-label">Restliche Betten im Zimmer:</div>
                                                <div className="restriction-grid">
                                                    {['none', 'blocked', 'women', 'men'].map(r => (
                                                        <label key={r} className={`restriction-option ${r !== 'none' ? r : ''} ${roomRestriction === r ? 'selected' : ''}`} onClick={() => setRoomRestriction(r)}>
                                                            <input type="radio" name="restriction" checked={roomRestriction === r} readOnly />
                                                            <span className="restriction-option-icon">{r === 'none' ? '‚úì' : r === 'blocked' ? 'üîí' : r === 'women' ? '‚ôÄÔ∏è' : '‚ôÇÔ∏è'}</span>
                                                            <span className="restriction-option-text">{r === 'none' ? 'Offen lassen' : r === 'blocked' ? 'Blockieren' : r === 'women' ? 'Frauenzimmer' : 'M√§nnerzimmer'}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        <div className="modal-buttons">
                                            <button className="btn btn-secondary" onClick={closeModal}>Abbrechen</button>
                                            {isBooked && <button className="btn btn-danger" onClick={handleCancel} disabled={saving}>{saving ? '...' : 'Stornieren'}</button>}
                                            <button className="btn btn-primary" onClick={handleBook} disabled={saving || !inputName.trim()}>{saving ? '...' : isBooked ? '√Ñndern' : 'Buchen'}</button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Warteliste Modal */}
                    {waitlistModalOpen && (
                        <div className="modal-overlay" onClick={closeWaitlistModal}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div className="modal-handle"></div>
                                <h2 className="waitlist-modal-title">üìã Warteliste</h2>
                                <p className="modal-room">Trage dich ein, falls gerade kein passendes Bett frei ist.</p>
                                <input type="text" className="modal-input waitlist-input" placeholder="Dein Name" value={waitlistName} onChange={e => setWaitlistName(e.target.value)} autoFocus disabled={saving} />
                                <textarea className="modal-textarea" placeholder="Kommentar (optional)..." value={waitlistComment} onChange={e => setWaitlistComment(e.target.value)} disabled={saving} />
                                <div className="modal-buttons">
                                    <button className="btn btn-secondary" onClick={closeWaitlistModal}>Abbrechen</button>
                                    <button className="btn btn-waitlist" onClick={handleAddToWaitlist} disabled={saving || !waitlistName.trim()}>{saving ? '...' : 'Eintragen'}</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
