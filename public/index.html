<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maitreffen ‚Äì Zimmerbuchung</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #e8f0e8;
            --bg-paper: #fffef9;
            --text-dark: #2c2c2c;
            --text-muted: #666;
            --bed-free: #7cb564;
            --bed-booked: #d96459;
            --bed-blocked: #9e9e9e;
            --accent: #5a9a48;
            --accent-light: #e8f4e8;
            --waitlist: #ff9800;
            --waitlist-light: #fff3e0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { 
            font-size: 16px;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-primary);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .app {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 50vh;
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .error-banner {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 0.9rem;
        }

        header {
            text-align: center;
            margin-bottom: 1.25rem;
            padding: 1.5rem 1rem;
            background: var(--bg-paper);
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid #d5e5d5;
        }

        h1 {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 0.25rem;
        }

        .subtitle { 
            color: var(--text-muted); 
            font-size: 0.9rem; 
        }

        .location {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-top: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--accent-light);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent);
        }

        .location a {
            color: inherit;
            text-decoration: none;
        }

        .location a:hover {
            text-decoration: underline;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 1.25rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.9rem;
        }

        .stat-dot {
            width: 14px;
            height: 14px;
            border-radius: 4px;
        }

        .stat-dot.free { background: var(--bed-free); }
        .stat-dot.booked { background: var(--bed-booked); }
        .stat-dot.blocked { background: var(--bed-blocked); }
        .stat-dot.waitlist { background: var(--waitlist); }

        .stat-value { font-weight: 700; }

        /* Full Banner */
        .full-banner {
            background: var(--waitlist-light);
            border: 2px solid var(--waitlist);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .full-banner-title {
            font-weight: 700;
            color: #e65100;
            margin-bottom: 0.5rem;
        }

        .full-banner-text {
            font-size: 0.9rem;
            color: #bf360c;
            margin-bottom: 0.75rem;
        }

        .full-banner .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Etagen-Tabs */
        .floor-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            background: var(--bg-paper);
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .floor-tab {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .floor-tab.active {
            background: var(--accent);
            color: white;
        }

        .floor-tab:not(.active):hover {
            background: var(--accent-light);
        }

        /* Zimmer Grid */
        .rooms-grid {
            display: grid;
            gap: 1rem;
        }

        .room-card {
            background: var(--bg-paper);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e8e8e8;
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .room-title {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.3rem;
            color: var(--text-dark);
        }

        .room-badges {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .room-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .room-badge.bath {
            background: #e3f2fd;
            color: #1976d2;
        }

        .room-badge.accessible {
            background: #fff3e0;
            color: #f57c00;
        }

        .room-badge.shared {
            background: #f5f5f5;
            color: #666;
        }

        .beds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 0.75rem;
        }

        .bed-card {
            background: var(--bed-free);
            border: 2px solid #5a9a48;
            border-radius: 10px;
            padding: 0.875rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
            min-height: 75px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .bed-card.booked {
            background: var(--bed-booked);
            border-color: #b84a40;
        }

        .bed-card.blocked {
            background: var(--bed-blocked);
            border-color: #757575;
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
        }

        .bed-card:active {
            transform: scale(0.97);
        }

        .bed-icon {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .bed-label {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.85);
            margin-bottom: 0.15rem;
        }

        .bed-name {
            font-weight: 700;
            color: white;
            font-size: 0.95rem;
            word-break: break-word;
        }

        .bed-blocked-info {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.7);
            margin-top: 0.2rem;
        }

        /* Room Summary */
        .room-summary {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #eee;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .room-stat {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .room-stat-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .room-stat-dot.free { background: var(--bed-free); }
        .room-stat-dot.booked { background: var(--bed-booked); }
        .room-stat-dot.blocked { background: var(--bed-blocked); }

        /* Warteliste Section */
        .waitlist-section {
            background: var(--bg-paper);
            border-radius: 16px;
            padding: 1.25rem;
            margin-top: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e8e8e8;
        }

        .waitlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .waitlist-title {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.2rem;
            color: var(--waitlist);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .waitlist-count {
            background: var(--waitlist);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .waitlist-empty {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--text-muted);
        }

        .waitlist-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .waitlist-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem;
            background: #f9f9f9;
            border-radius: 10px;
            border: 1px solid #eee;
        }

        .waitlist-position {
            width: 32px;
            height: 32px;
            background: var(--waitlist);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .waitlist-info {
            flex: 1;
            min-width: 0;
        }

        .waitlist-name {
            font-weight: 600;
            color: var(--text-dark);
            word-break: break-word;
        }

        .waitlist-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.15rem;
        }

        .waitlist-comment {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 0.25rem;
        }

        .waitlist-remove {
            background: none;
            border: none;
            color: var(--bed-booked);
            cursor: pointer;
            padding: 0.5rem;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .waitlist-remove:hover {
            opacity: 1;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: var(--bg-paper);
            border-radius: 24px 24px 0 0;
            padding: 1.5rem;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }

        .modal-handle {
            width: 40px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin: 0 auto 1.25rem;
        }

        .modal h2 {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
            color: var(--accent);
        }

        .modal h2.waitlist-modal-title {
            color: var(--waitlist);
        }

        .modal-room {
            color: var(--text-muted);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .modal-input {
            width: 100%;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #ddd;
            background: #fff;
            color: var(--text-dark);
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            margin-bottom: 0.75rem;
            transition: border-color 0.2s;
            -webkit-appearance: none;
        }

        .modal-input:focus { 
            outline: none; 
            border-color: var(--accent); 
        }

        .modal-input.waitlist-input:focus {
            border-color: var(--waitlist);
        }

        .modal-textarea {
            width: 100%;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #ddd;
            background: #fff;
            color: var(--text-dark);
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            margin-bottom: 0.75rem;
            transition: border-color 0.2s;
            -webkit-appearance: none;
            resize: vertical;
            min-height: 80px;
        }

        .modal-textarea:focus {
            outline: none;
            border-color: var(--waitlist);
        }

        .checkbox-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 12px;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .checkbox-wrapper:hover {
            background: #efefef;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .checkbox-label {
            flex: 1;
        }

        .checkbox-label-main {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.2rem;
        }

        .checkbox-label-sub {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .btn {
            flex: 1;
            padding: 1rem;
            border-radius: 12px;
            border: none;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn:active:not(:disabled) { transform: scale(0.98); }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: #e0e0e0; color: var(--text-dark); }
        .btn-danger { background: var(--bed-booked); color: white; }
        .btn-waitlist { background: var(--waitlist); color: white; }

        .current-guest {
            background: #f5f5f5;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .current-guest-label { 
            font-size: 0.75rem; 
            color: var(--text-muted); 
            margin-bottom: 0.2rem; 
        }
        
        .current-guest-name { 
            font-weight: 600; 
            color: var(--text-dark);
        }

        .blocked-info {
            background: #fff3e0;
            border: 1px solid #ffcc80;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .blocked-info-title {
            font-weight: 600;
            color: #e65100;
            margin-bottom: 0.25rem;
        }

        .blocked-info-text {
            font-size: 0.85rem;
            color: #bf360c;
        }

        /* Info Section */
        .info-section {
            background: var(--bg-paper);
            border-radius: 16px;
            padding: 1.25rem;
            margin-top: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e8e8e8;
        }

        .info-title {
            font-family: 'Architects Daughter', cursive;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            color: var(--accent);
        }

        .info-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .info-text a {
            color: var(--accent);
        }

        /* Desktop */
        @media (min-width: 768px) {
            .app { padding: 1.5rem; }
            h1 { font-size: 2.4rem; }
            
            .rooms-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-overlay {
                align-items: center;
                padding: 1rem;
            }
            
            .modal {
                border-radius: 20px;
            }
            
            .modal-handle { display: none; }
        }

        @media (min-width: 1024px) {
            .rooms-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const API_URL = '/api';

        // Zimmer-Konfiguration basierend auf freizeitheim-halbe.de
        const ROOMS = [
            { id: 1, name: 'Zimmer 1', beds: 3, floor: 'eg', bath: true, accessible: false },
            { id: 2, name: 'Zimmer 2', beds: 2, floor: 'eg', bath: true, accessible: true },
            { id: 3, name: 'Zimmer 3', beds: 2, floor: 'eg', bath: true, accessible: false },
            { id: 4, name: 'Zimmer 4', beds: 3, floor: 'og', bath: false, accessible: false },
            { id: 5, name: 'Zimmer 5', beds: 4, floor: 'og', bath: false, accessible: false },
            { id: 6, name: 'Zimmer 6', beds: 3, floor: 'og', bath: false, accessible: false },
            { id: 7, name: 'Zimmer 7', beds: 3, floor: 'og', bath: false, accessible: false },
            { id: 8, name: 'Zimmer 8', beds: 2, floor: 'og', bath: false, accessible: false },
            { id: 9, name: 'Zimmer 9', beds: 3, floor: 'og', bath: false, accessible: false },
        ];

        // Generiere Bett-IDs
        const generateBeds = () => {
            const beds = {};
            ROOMS.forEach(room => {
                for (let i = 1; i <= room.beds; i++) {
                    const bedId = `zi${room.id}-bett${i}`;
                    beds[bedId] = { room: room.name, roomId: room.id, bedNum: i };
                }
            });
            return beds;
        };

        const BEDS = generateBeds();
        const TOTAL_SLOTS = Object.keys(BEDS).length; // 25

        // Hilfsfunktion: Alle Bett-IDs eines Zimmers
        const getRoomBedIds = (roomId) => {
            const room = ROOMS.find(r => r.id === roomId);
            if (!room) return [];
            return Array.from({ length: room.beds }, (_, i) => `zi${roomId}-bett${i + 1}`);
        };

        // Datum formatieren
        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('de-DE', { 
                day: '2-digit', 
                month: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        };

        function App() {
            const [bookings, setBookings] = useState({});
            const [waitlist, setWaitlist] = useState([]);
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [error, setError] = useState(null);
            const [modalOpen, setModalOpen] = useState(false);
            const [waitlistModalOpen, setWaitlistModalOpen] = useState(false);
            const [selectedBed, setSelectedBed] = useState(null);
            const [inputName, setInputName] = useState("");
            const [waitlistName, setWaitlistName] = useState("");
            const [waitlistComment, setWaitlistComment] = useState("");
            const [blockRoom, setBlockRoom] = useState(false);
            const [activeFloor, setActiveFloor] = useState('eg');

            useEffect(() => { 
                loadBookings(); 
                loadWaitlist();
            }, []);

            const loadBookings = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    const response = await fetch(`${API_URL}/bookings`);
                    if (!response.ok) throw new Error('Fehler beim Laden');
                    const data = await response.json();
                    setBookings(data);
                } catch (err) {
                    console.error('Ladefehler:', err);
                    setError('Buchungen konnten nicht geladen werden.');
                } finally {
                    setLoading(false);
                }
            };

            const loadWaitlist = async () => {
                try {
                    const response = await fetch(`${API_URL}/waitlist`);
                    if (!response.ok) throw new Error('Fehler beim Laden');
                    const data = await response.json();
                    setWaitlist(data);
                } catch (err) {
                    console.error('Warteliste Ladefehler:', err);
                }
            };

            const handleBedClick = (bedId) => {
                setSelectedBed(bedId);
                const booking = bookings[bedId];
                setInputName(booking?.name?.replace(/^üîí\s*/, '') || "");
                setBlockRoom(false);
                setModalOpen(true);
            };

            const handleBook = async () => {
                if (!inputName.trim() || saving) return;
                setSaving(true);
                setError(null);
                try {
                    const roomId = BEDS[selectedBed].roomId;
                    const roomBeds = getRoomBedIds(roomId);
                    
                    const response = await fetch(`${API_URL}/bookings/${selectedBed}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            name: inputName.trim(),
                            blockRoom: blockRoom,
                            roomBeds: roomBeds
                        })
                    });
                    if (!response.ok) throw new Error('Speichern fehlgeschlagen');
                    await loadBookings();
                    closeModal();
                } catch (err) {
                    setError('Buchung konnte nicht gespeichert werden.');
                } finally {
                    setSaving(false);
                }
            };

            const handleCancel = async () => {
                if (saving) return;
                setSaving(true);
                setError(null);
                try {
                    const response = await fetch(`${API_URL}/bookings/${selectedBed}`, { method: 'DELETE' });
                    if (!response.ok) throw new Error('L√∂schen fehlgeschlagen');
                    await loadBookings();
                    closeModal();
                } catch (err) {
                    setError('Stornierung fehlgeschlagen.');
                } finally {
                    setSaving(false);
                }
            };

            const handleUnblock = async () => {
                if (saving) return;
                setSaving(true);
                setError(null);
                try {
                    const response = await fetch(`${API_URL}/bookings/${selectedBed}/unblock`, { method: 'DELETE' });
                    if (!response.ok) throw new Error('Freigeben fehlgeschlagen');
                    await loadBookings();
                    closeModal();
                } catch (err) {
                    setError('Freigabe fehlgeschlagen.');
                } finally {
                    setSaving(false);
                }
            };

            const handleAddToWaitlist = async () => {
                if (!waitlistName.trim() || saving) return;
                setSaving(true);
                setError(null);
                try {
                    const response = await fetch(`${API_URL}/waitlist`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            name: waitlistName.trim(),
                            comment: waitlistComment.trim() || null
                        })
                    });
                    if (!response.ok) throw new Error('Speichern fehlgeschlagen');
                    await loadWaitlist();
                    closeWaitlistModal();
                } catch (err) {
                    setError('Konnte nicht zur Warteliste hinzugef√ºgt werden.');
                } finally {
                    setSaving(false);
                }
            };

            const handleRemoveFromWaitlist = async (id) => {
                if (saving) return;
                if (!confirm('Wirklich von der Warteliste entfernen?')) return;
                setSaving(true);
                try {
                    const response = await fetch(`${API_URL}/waitlist/${id}`, { method: 'DELETE' });
                    if (!response.ok) throw new Error('L√∂schen fehlgeschlagen');
                    await loadWaitlist();
                } catch (err) {
                    setError('Entfernen fehlgeschlagen.');
                } finally {
                    setSaving(false);
                }
            };

            const closeModal = () => {
                setModalOpen(false);
                setSelectedBed(null);
                setInputName("");
                setBlockRoom(false);
            };

            const closeWaitlistModal = () => {
                setWaitlistModalOpen(false);
                setWaitlistName("");
                setWaitlistComment("");
            };

            const countStats = () => {
                let booked = 0;
                let blocked = 0;
                Object.values(bookings).forEach(b => {
                    if (b.status === 'blocked') blocked++;
                    else booked++;
                });
                return { booked, blocked, free: TOTAL_SLOTS - booked - blocked };
            };

            const stats = countStats();
            const isFull = stats.free === 0;

            const getRoomStats = (roomId) => {
                const room = ROOMS.find(r => r.id === roomId);
                let booked = 0;
                let blocked = 0;
                for (let i = 1; i <= room.beds; i++) {
                    const booking = bookings[`zi${roomId}-bett${i}`];
                    if (booking) {
                        if (booking.status === 'blocked') blocked++;
                        else booked++;
                    }
                }
                return { booked, blocked, free: room.beds - booked - blocked, total: room.beds };
            };

            const filteredRooms = ROOMS.filter(room => room.floor === activeFloor);

            const getFloorFreeCount = (floor) => {
                return ROOMS.filter(r => r.floor === floor).reduce((sum, r) => {
                    const s = getRoomStats(r.id);
                    return sum + s.free;
                }, 0);
            };

            // Pr√ºfe ob es freie Betten im Zimmer gibt (f√ºr Checkbox Anzeige)
            const hasFreeBeds = () => {
                if (!selectedBed) return false;
                const roomId = BEDS[selectedBed].roomId;
                const roomBeds = getRoomBedIds(roomId);
                return roomBeds.some(bedId => bedId !== selectedBed && !bookings[bedId]);
            };

            // Finde den Namen der blockierenden Person
            const getBlockerName = (booking) => {
                if (!booking || !booking.blockedBy) return null;
                const blockerBooking = bookings[booking.blockedBy];
                return blockerBooking?.name || null;
            };

            if (loading) {
                return <div className="app"><div className="loading">üå≥ Lade Buchungen...</div></div>;
            }

            const selectedBooking = selectedBed ? bookings[selectedBed] : null;
            const isBlocked = selectedBooking?.status === 'blocked';
            const isBooked = selectedBooking && !isBlocked;

            return (
                <div className="app">
                    {error && <div className="error-banner">‚ö†Ô∏è {error}</div>}

                    <header>
                        <h1>üå≤ Maitreffen</h1>
                        <p className="subtitle">Zimmerbelegung ‚Äì tippe auf ein Bett</p>
                        <div className="location">
                            üìç <a href="https://www.freizeitheim-halbe.de" target="_blank" rel="noopener">Freizeitheim Halbe</a>
                        </div>
                        <div className="stats">
                            <div className="stat">
                                <div className="stat-dot free"></div>
                                <span><span className="stat-value">{stats.free}</span> frei</span>
                            </div>
                            <div className="stat">
                                <div className="stat-dot booked"></div>
                                <span><span className="stat-value">{stats.booked}</span> belegt</span>
                            </div>
                            {stats.blocked > 0 && (
                                <div className="stat">
                                    <div className="stat-dot blocked"></div>
                                    <span><span className="stat-value">{stats.blocked}</span> blockiert</span>
                                </div>
                            )}
                            {waitlist.length > 0 && (
                                <div className="stat">
                                    <div className="stat-dot waitlist"></div>
                                    <span><span className="stat-value">{waitlist.length}</span> Warteliste</span>
                                </div>
                            )}
                        </div>
                    </header>

                    {/* Ausgebucht Banner */}
                    {isFull && (
                        <div className="full-banner">
                            <div className="full-banner-title">üéâ Alle Betten sind belegt!</div>
                            <div className="full-banner-text">
                                Du kannst dich unten auf die Warteliste setzen lassen, falls jemand absagt.
                            </div>
                        </div>
                    )}

                    {/* Etagen-Tabs */}
                    <div className="floor-tabs">
                        <button 
                            className={`floor-tab ${activeFloor === 'eg' ? 'active' : ''}`}
                            onClick={() => setActiveFloor('eg')}
                        >
                            Erdgeschoss ({getFloorFreeCount('eg')} frei)
                        </button>
                        <button 
                            className={`floor-tab ${activeFloor === 'og' ? 'active' : ''}`}
                            onClick={() => setActiveFloor('og')}
                        >
                            Obergeschoss ({getFloorFreeCount('og')} frei)
                        </button>
                    </div>

                    {/* Zimmer Cards */}
                    <div className="rooms-grid">
                        {filteredRooms.map(room => {
                            const roomStats = getRoomStats(room.id);
                            return (
                                <div key={room.id} className="room-card">
                                    <div className="room-header">
                                        <h3 className="room-title">{room.name}</h3>
                                        <div className="room-badges">
                                            {room.bath && <span className="room-badge bath">üöø Eigenes Bad</span>}
                                            {room.accessible && <span className="room-badge accessible">‚ôø Barrierefrei</span>}
                                            {!room.bath && <span className="room-badge shared">Gemeinschaftsbad</span>}
                                        </div>
                                    </div>
                                    <div className="beds-grid">
                                        {Array.from({ length: room.beds }, (_, i) => {
                                            const bedId = `zi${room.id}-bett${i + 1}`;
                                            const booking = bookings[bedId];
                                            const isBooked = booking && booking.status !== 'blocked';
                                            const isBlocked = booking?.status === 'blocked';
                                            return (
                                                <div 
                                                    key={bedId}
                                                    className={`bed-card ${isBooked ? 'booked' : ''} ${isBlocked ? 'blocked' : ''}`}
                                                    onClick={() => handleBedClick(bedId)}
                                                >
                                                    <div className="bed-icon">
                                                        {isBlocked ? 'üîí' : (isBooked ? 'üò¥' : 'üõèÔ∏è')}
                                                    </div>
                                                    <div className="bed-label">Bett {i + 1}</div>
                                                    <div className="bed-name">
                                                        {isBlocked ? 'Blockiert' : (isBooked ? booking.name : 'Frei')}
                                                    </div>
                                                    {isBlocked && booking.blockedBy && (
                                                        <div className="bed-blocked-info">
                                                            von {bookings[booking.blockedBy]?.name || '?'}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <div className="room-summary">
                                        <div className="room-stat">
                                            <div className="room-stat-dot free"></div>
                                            <span>{roomStats.free} frei</span>
                                        </div>
                                        <div className="room-stat">
                                            <div className="room-stat-dot booked"></div>
                                            <span>{roomStats.booked} belegt</span>
                                        </div>
                                        {roomStats.blocked > 0 && (
                                            <div className="room-stat">
                                                <div className="room-stat-dot blocked"></div>
                                                <span>{roomStats.blocked} blockiert</span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Warteliste */}
                    <div className="waitlist-section">
                        <div className="waitlist-header">
                            <h4 className="waitlist-title">
                                üìã Warteliste
                                {waitlist.length > 0 && (
                                    <span className="waitlist-count">{waitlist.length}</span>
                                )}
                            </h4>
                            <button 
                                className="btn btn-waitlist" 
                                style={{flex: 'none', padding: '0.5rem 1rem', fontSize: '0.85rem'}}
                                onClick={() => setWaitlistModalOpen(true)}
                            >
                                + Eintragen
                            </button>
                        </div>
                        
                        {waitlist.length === 0 ? (
                            <div className="waitlist-empty">
                                <p>Noch niemand auf der Warteliste</p>
                            </div>
                        ) : (
                            <div className="waitlist-list">
                                {waitlist.map((entry, index) => (
                                    <div key={entry.id} className="waitlist-item">
                                        <div className="waitlist-position">{index + 1}</div>
                                        <div className="waitlist-info">
                                            <div className="waitlist-name">{entry.name}</div>
                                            <div className="waitlist-meta">
                                                Eingetragen am {formatDate(entry.created_at)}
                                            </div>
                                            {entry.comment && (
                                                <div className="waitlist-comment">"{entry.comment}"</div>
                                            )}
                                        </div>
                                        <button 
                                            className="waitlist-remove"
                                            onClick={() => handleRemoveFromWaitlist(entry.id)}
                                            title="Entfernen"
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Info */}
                    <div className="info-section">
                        <h4 className="info-title">‚ÑπÔ∏è √úber das Haus</h4>
                        <p className="info-text">
                            Das Evangelische Freizeitheim Halbe bietet 9 Zimmer mit insgesamt 25 Betten.<br/><br/>
                            <strong>Erdgeschoss:</strong> 3 Zimmer mit eigenem Bad (Zi 2 ist barrierefrei)<br/>
                            <strong>Obergeschoss:</strong> 6 Zimmer mit 2 Gemeinschaftsb√§dern<br/><br/>
                            üõèÔ∏è <strong>Bettw√§sche ist mitzubringen</strong> oder kann f√ºr 8,50 ‚Ç¨ ausgeliehen werden.<br/><br/>
                            üîí <strong>Tipp:</strong> Du kannst beim Buchen die restlichen Betten im Zimmer blockieren.<br/>
                            üìã <strong>Warteliste:</strong> Falls kein passendes Bett frei ist, trage dich auf die Warteliste ein.<br/><br/>
                            üìç Kirchstra√üe 7, 15757 Halbe<br/>
                            üåê <a href="https://www.freizeitheim-halbe.de" target="_blank" rel="noopener">www.freizeitheim-halbe.de</a>
                        </p>
                    </div>

                    {/* Bett Modal */}
                    {modalOpen && selectedBed && (
                        <div className="modal-overlay" onClick={closeModal}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div className="modal-handle"></div>
                                
                                {isBlocked ? (
                                    // Blockiertes Bett Modal
                                    <>
                                        <h2>üîí Blockiert</h2>
                                        <p className="modal-room">
                                            {BEDS[selectedBed].room} ‚Äì Bett {BEDS[selectedBed].bedNum}
                                        </p>
                                        
                                        <div className="blocked-info">
                                            <div className="blocked-info-title">Dieses Bett ist blockiert</div>
                                            <div className="blocked-info-text">
                                                Blockiert von: {getBlockerName(selectedBooking) || 'Unbekannt'}
                                            </div>
                                        </div>

                                        <div className="modal-buttons">
                                            <button className="btn btn-secondary" onClick={closeModal} disabled={saving}>
                                                Schlie√üen
                                            </button>
                                            <button className="btn btn-danger" onClick={handleUnblock} disabled={saving}>
                                                {saving ? '...' : 'Freigeben'}
                                            </button>
                                        </div>
                                    </>
                                ) : (
                                    // Normale Buchung Modal
                                    <>
                                        <h2>{isBooked ? 'üìù Bearbeiten' : '‚ú® Reservieren'}</h2>
                                        <p className="modal-room">
                                            {BEDS[selectedBed].room} ‚Äì Bett {BEDS[selectedBed].bedNum}
                                        </p>

                                        {isBooked && (
                                            <div className="current-guest">
                                                <div className="current-guest-label">Aktuell gebucht:</div>
                                                <div className="current-guest-name">{selectedBooking.name}</div>
                                            </div>
                                        )}

                                        <input
                                            type="text"
                                            className="modal-input"
                                            placeholder="Dein Name"
                                            value={inputName}
                                            onChange={e => setInputName(e.target.value)}
                                            autoFocus
                                            disabled={saving}
                                            onKeyDown={e => e.key === 'Enter' && handleBook()}
                                            autoComplete="name"
                                            autoCapitalize="words"
                                        />

                                        {/* Zimmer blockieren Checkbox - nur bei neuer Buchung und wenn freie Betten */}
                                        {!isBooked && hasFreeBeds() && (
                                            <label className="checkbox-wrapper" onClick={() => setBlockRoom(!blockRoom)}>
                                                <input
                                                    type="checkbox"
                                                    checked={blockRoom}
                                                    onChange={e => setBlockRoom(e.target.checked)}
                                                    onClick={e => e.stopPropagation()}
                                                />
                                                <div className="checkbox-label">
                                                    <div className="checkbox-label-main">üîí Restliche Betten blockieren</div>
                                                    <div className="checkbox-label-sub">
                                                        Andere k√∂nnen dann nicht in dieses Zimmer buchen
                                                    </div>
                                                </div>
                                            </label>
                                        )}

                                        <div className="modal-buttons">
                                            <button className="btn btn-secondary" onClick={closeModal} disabled={saving}>
                                                Abbrechen
                                            </button>
                                            {isBooked && (
                                                <button className="btn btn-danger" onClick={handleCancel} disabled={saving}>
                                                    {saving ? '...' : 'Stornieren'}
                                                </button>
                                            )}
                                            <button className="btn btn-primary" onClick={handleBook} disabled={saving || !inputName.trim()}>
                                                {saving ? '...' : (isBooked ? '√Ñndern' : 'Buchen')}
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Warteliste Modal */}
                    {waitlistModalOpen && (
                        <div className="modal-overlay" onClick={closeWaitlistModal}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div className="modal-handle"></div>
                                <h2 className="waitlist-modal-title">üìã Warteliste</h2>
                                <p className="modal-room">
                                    Trage dich ein, falls gerade kein passendes Bett frei ist ‚Äì z.B. wenn du mit mehreren Personen kommst oder ein bestimmtes Zimmer m√∂chtest.
                                </p>

                                <input
                                    type="text"
                                    className="modal-input waitlist-input"
                                    placeholder="Dein Name"
                                    value={waitlistName}
                                    onChange={e => setWaitlistName(e.target.value)}
                                    autoFocus
                                    disabled={saving}
                                    autoComplete="name"
                                    autoCapitalize="words"
                                />

                                <textarea
                                    className="modal-textarea"
                                    placeholder="Kommentar (optional) ‚Äì z.B. bevorzugtes Zimmer, Anreise..."
                                    value={waitlistComment}
                                    onChange={e => setWaitlistComment(e.target.value)}
                                    disabled={saving}
                                />

                                <div className="modal-buttons">
                                    <button className="btn btn-secondary" onClick={closeWaitlistModal} disabled={saving}>
                                        Abbrechen
                                    </button>
                                    <button 
                                        className="btn btn-waitlist" 
                                        onClick={handleAddToWaitlist} 
                                        disabled={saving || !waitlistName.trim()}
                                    >
                                        {saving ? '...' : 'Eintragen'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
